# PG File Storage - –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ PostgreSQL

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL Large Objects.
![–°–Ω–∏–º–æ–∫ —Å —ç–∫—Ä–∞–Ω–∞](screen.png)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
```bash
docker-compose up -d
```

### –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- **Frontend:** http://localhost:3000
- **API:** http://localhost:8000
- **pgAdmin:** http://localhost:5050

### –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞
- **pgAdmin:** admin@example.com / admin
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** admin / password
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** admin / password (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
![–ö–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –≤—Ö–æ–¥ –≤ PgAdmin4](pg_screen.png)

## üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------|----------|
| Frontend (React) | 3000 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| API (PHP) | 8000 | REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏ |
| PostgreSQL | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å Large Objects |
| pgAdmin | 5050 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î |

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ pgAdmin](PGADMIN_SETUP.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- [API Documentation](api/README.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ REST API
- [Frontend Documentation](frontend/README.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

---

# –•—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (Large Objects ‚Äî LOB) –≤ PostgreSQL
–ê–Ω–∞–ª–∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤.  
–†–∞–∑–±–µ—Ä—ë–º —Å–ø–æ—Å–æ–±—ã, –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Å–≤—è–∑–∫–µ —Å PHP/Yii2, –∞ —Ç–∞–∫–∂–µ –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

### –ö—Ä–∞—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤

| –°–ø–æ—Å–æ–± | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| :--- | :--- | :--- | :--- |
| **–¢–∏–ø `bytea`** | –ü—Ä–æ—Å—Ç–æ—Ç–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏", —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ –≤—Å–µ–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ~1 –ì–ë, –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –≤ –ø–∞–º—è—Ç–∏, –Ω–µ—Ç –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ | –ù–µ–±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (–¥–æ –¥–µ—Å—è—Ç–∫–æ–≤ –ú–ë): –∫–∞—Ä—Ç–∏–Ω–∫–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã, PDF |
| **Large Objects (LOB)** | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏, —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ > 1 –ì–ë | –°–ª–æ–∂–Ω–µ–µ API, —Ç—Ä–µ–±—É—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã,** –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —á–∞—Å—Ç—è–º–∏: –≤–∏–¥–µ–æ, –±–æ–ª—å—à–∏–µ –∞—Ä—Ö–∏–≤—ã, –æ–±—Ä–∞–∑—ã –¥–∏—Å–∫–æ–≤ |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –≤ –ë–î** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞, –ª–µ–≥–∫–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å | –ü–æ—Ç–µ—Ä—è –≥–∞—Ä–∞–Ω—Ç–∏–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–§–∞–π–ª –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Ä—É—á–Ω—É—é) | **–ß–∞—â–µ –≤—Å—Ç—Ä–µ—á–∞—é—â–∞—è—Å—è –ø—Ä–∞–∫—Ç–∏–∫–∞.** –§–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ/NFS, –∞ –≤ –ë–î ‚Äî —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—É—Ç—å |

---

### 1. –¢–∏–ø `bytea` ‚Äî –ü—Ä–æ—Å—Ç–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ "–≤ —Å—Ç—Ä–æ–∫–µ"

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±. –í—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ –¥–≤–æ–∏—á–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø—Ä—è–º–æ –≤ –∫–æ–ª–æ–Ω–∫–µ —Ç–∞–±–ª–∏—Ü—ã.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ PHP/Yii2:**

```php
// 1. –ú–∏–≥—Ä–∞—Ü–∏—è –≤ Yii2 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
public function safeUp()
{
    $this->createTable('documents', [
        'id' => $this->primaryKey(),
        'name' => $this->string()->notNull(),
        'mime_type' => $this->string(),
        'content' => $this->binary(), // –î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
        // 'content' => $this->db->schema->createColumnSchemaBuilder('longblob'), // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä
        'created_at' => $this->timestamp(),
    ]);
}

// 2. –ú–æ–¥–µ–ª—å Document
class Document extends \yii\db\ActiveRecord
{
    // ...
}

// 3. –ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ –≤ –ë–î (–≤ Controller)
$filePath = '/path/to/your/file.zip';
$fileContent = file_get_contents($filePath);

$document = new Document();
$document->name = 'my_file.zip';
$document->mime_type = 'application/zip';
$document->content = $fileContent; // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞

if ($document->save()) {
    // –£—Å–ø–µ—Ö!
}

// 4. –ß—Ç–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∫–ª–∏–µ–Ω—Ç—É (–≤ Controller)
$document = Document::findOne($id);

// –í–∞–∂–Ω–æ: –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –º–æ–∂–µ—Ç —Å—ä–µ—Å—Ç—å –≤—Å—é –ø–∞–º—è—Ç—å!
Yii::$app->response->sendContentAsFile(
    $document->content, 
    $document->name, 
    ['mimeType' => $document->mime_type]
);
return;
```

---

### 2. –ù–∞—Ç–∏–≤–Ω—ã–µ Large Objects (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å–ø–æ—Å–æ–±)

PostgreSQL –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º `Large Objects`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `pg_largeobject` –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ OID (Object Identifier). –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî **–ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ (streaming)** –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å PHP.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é `pgsql` —Ñ—É–Ω–∫—Ü–∏–π PHP:**

```php
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –ù–ï –∏—Å–ø–æ–ª—å–∑—É—è PDO, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
$conn = pg_connect("host=localhost dbname=test user=postgres");
pg_query($conn, "BEGIN"); // –í–∞–∂–Ω–æ: —Ä–∞–±–æ—Ç–∞ —Å LOB –≤—Å–µ–≥–¥–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!

// 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ LOB –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –µ–≥–æ OID
$oid = pg_lo_create($conn);
if (!$oid) { die("Cannot create large object"); }

// 2. –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
$lob = pg_lo_open($conn, $oid, 'w');
if (!$lob) { die("Cannot open large object"); }

// 3. –ü–û–¢–û–ö–û–í–ê–Ø –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
$fileHandle = fopen('/path/to/huge/video.mov', 'r');
while ($data = fread($fileHandle, 4096)) { // –ß–∏—Ç–∞–µ–º –ø–æ –∫—É—Å–æ—á–∫–∞–º
    pg_lo_write($lob, $data);
}
fclose($fileHandle);

// 4. –ó–∞–∫—Ä—ã—Ç–∏–µ LOB –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
pg_lo_close($lob);
pg_query($conn, "COMMIT");

// 5. –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç $oid –≤ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ –≤ –∫–æ–ª–æ–Ω–∫–µ —Ç–∏–ø–∞ OID
$query = "INSERT INTO documents (name, file_oid) VALUES ('video.mov', $oid)";
pg_query($conn, $query);

// –ß–¢–ï–ù–ò–ï –∏ –æ—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–∞ –ø–æ—Ç–æ–∫–æ–º:
$document = // ... –ø–æ–ª—É—á–∏–ª–∏ –∑–∞–ø–∏—Å—å –∏–∑ –ë–î, –≤ –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å OID
$oid = $document->file_oid;

header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="video.mov"');

pg_query($conn, "BEGIN");
$lob = pg_lo_open($conn, $oid, 'r');
while ($data = pg_lo_read($lob, 4096)) { // –ß–∏—Ç–∞–µ–º –ø–æ –∫—É—Å–æ—á–∫–∞–º –∏ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
    echo $data;
    flush(); // –í–∞–∂–Ω–æ: —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –±—É—Ñ–µ—Ä –≤—ã–≤–æ–¥–∞
}
pg_lo_close($lob);
pg_query($conn, "COMMIT");
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Yii2 (–∏—Å–ø–æ–ª—å–∑—É—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π `Command`):**

Yii2 –ø–æ–≤–µ—Ä—Ö PDO, –∞ —É PDO –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ LOB-—Ñ—É–Ω–∫—Ü–∏—è–º PostgreSQL. –ü–æ—ç—Ç–æ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `pg_lo_*` —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ä–µ—Å—É—Ä—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

```php
// –í–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–∞
$db = Yii::$app->db;
$pdo = $db->pdo;

// –ü–æ–ª—É—á–∞–µ–º native PDO connection resource (–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–µ –≤–æ –≤—Å–µ—Ö —Å–±–æ—Ä–∫–∞—Ö PHP)
// –ß–∞—â–µ –ø—Ä–æ—â–µ –≤—ã–Ω–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É —Å LOB –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±.
```

**–ò–∑-–∑–∞ —ç—Ç–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —á–∞—Å—Ç–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –ø–µ—Ä–≤—ã–π –∏–ª–∏ —Ç—Ä–µ—Ç–∏–π —Å–ø–æ—Å–æ–±.**

---

### 3. –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –º–æ–¥—É–ª–∏ –¥–ª—è Yii2

#### a) `moonlandsoft/yii2-upload`

–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤. –û–±—ã—á–Ω–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–µ—Ç–∏–π —Å–ø–æ—Å–æ–±** (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –≤ 95% —Å–ª—É—á–∞–µ–≤.

**–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞: `composer require moonlandsoft/yii2-upload`
2. –í –∫–æ–Ω—Ñ–∏–≥–µ:
```php
'modules' => [
    'upload' => [
        'class' => 'moonland\upload\Upload',
        'root' => '@webroot/uploads', // –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã
        'baseUrl' => '@web/uploads',   // Base URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
    ],
],
```
3. –í –º–æ–¥–µ–ª–∏:
```php
use moonland\upload\UploadBehavior;

public function behaviors()
{
    return [
        [
            'class' => UploadBehavior::class,
            'attributes' => [
                'file_path' => [ // –∞—Ç—Ä–∏–±—É—Ç –º–æ–¥–µ–ª–∏, –∫—É–¥–∞ –∑–∞–ø–∏—à–µ—Ç—Å—è –ø—É—Ç—å
                    'path' => '@webroot/uploads/files',
                    'tempPath' => '@webroot/uploads/tmp',
                    'baseUrl' => '@web/uploads/files',
                ],
            ],
        ],
    ];
}
```
–ú–æ–¥—É–ª—å —Å–∞–º –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫ –∏ –∑–∞–ø–∏—à–µ—Ç –ø—É—Ç—å –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏.

#### b) –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è (Behavior)

–ß–∞—Å—Ç–æ –ø–∏—à—É—Ç —Å–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π `FileBehavior`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ: handling –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏, —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ —Ç.–¥. –í –ë–î –ø—Ä–∏ —ç—Ç–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É—Ç—å (`varchar`) –∏–ª–∏ –¥–∞–∂–µ —á–∞—Å—Ç—å –ø—É—Ç–∏, –µ—Å–ª–∏ –∫–æ—Ä–µ–Ω—å –∏–∑–≤–µ—Å—Ç–µ–Ω.

**–ü—Å–µ–≤–¥–æ–∫–æ–¥ —Å–≤–æ–µ–≥–æ Behavior:**
```php
class FileBehavior extends Behavior
{
    public $attributeName = 'file';

    public function events()
    {
        return [
            ActiveRecord::EVENT_BEFORE_VALIDATE => 'beforeValidate',
            ActiveRecord::EVENT_BEFORE_INSERT => 'beforeSave',
            ActiveRecord::EVENT_BEFORE_UPDATE => 'beforeSave',
            ActiveRecord::EVENT_AFTER_DELETE => 'afterDelete',
        ];
    }

    public function beforeValidate($event) { /* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ */ }
    public function beforeSave($event) {
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫
        // –ó–∞–ø–∏—Å—å –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ –∞—Ç—Ä–∏–±—É—Ç –º–æ–¥–µ–ª–∏
        $this->owner->file_path = $this->saveFile();
    }
    public function afterDelete($event) { /* –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –¥–∏—Å–∫–∞ */ }
}
```

### –ò—Ç–æ–≥ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

1.  **–î–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–¥–æ ~20-50 –ú–ë)** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **`bytea`**. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ.
2.  **–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (–≤–∏–¥–µ–æ, –∞—Ä—Ö–∏–≤—ã –≥–∏–≥–∞–±–∞–π—Ç–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞)**, –µ—Å–ª–∏ –≤—ã *–æ–±—è–∑–∞–Ω—ã* —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–Ω–∞—Ç–∏–≤–Ω—ã–µ Large Objects** —Å –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ–π. –ë—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `pg_*`.
3.  **–í –ø–æ–¥–∞–≤–ª—è—é—â–µ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤** **–ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è "–§–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ + –ø—É—Ç—å –≤ –ë–î"**. –≠—Ç–æ —Ä–µ–∞–ª–∏–∑—É—é—Ç –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ –º–æ–¥—É–ª–∏ (–≤—Ä–æ–¥–µ `moonlandsoft/yii2-upload`) –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –≠—Ç–æ –¥–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç—É —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (—Ñ–∞–π–ª—ã –∏ –ë–î –æ—Ç–¥–µ–ª—å–Ω–æ) –∏ –ª–µ–≥–∫–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NFS –∏–ª–∏ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).